import groovy.json.JsonSlurper
pipeline{
    agent any
    stages{
        stage('Example'){
            steps{
                sh "printenv"
                echo $branch
                echo "hello world"
            }
        }
        stage('Master Branch'){
            when{
                branch 'origin/master'
            }
            steps{
                echo 'master commit'
            }
        }
        stage('Feature Branch'){
            when{
                branch 'origin/feature'
            }
            steps{
                echo 'feature commit'
            }
        }
        stage('Get'){
            steps{
                script{
                    def code =sh(script:"curl https://cloudapi.bytedance.net/faas/services/ttwcxk/invoke/jenkins_apk_builder > index.json",returnStatus:true)
                    if(code == 0){
                        def result =sh(script:"cat index.json",returnStdout: true)
                        def result_json = new JsonSlurper()
                        def result_map = result_json.parseText(result)

                        print "结果code："+result_map.code
                        print "结果msg："+result_map.msg
                    }else{
                        sh 'exit 1'
                    }
                }
            }
        }
    }
}